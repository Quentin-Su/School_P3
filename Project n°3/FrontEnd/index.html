<!DOCTYPE html>
<html lang="fr">

<head>
	<meta charset="UTF-8">
	<title>Sophie Bluel - Architecte d'intérieur</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Work+Sans&display=swap"
		rel="stylesheet">
	<meta name="description" content="">
	<link rel="stylesheet" href="./assets/style.css">
</head>

<body>
	<header>
		<h1>Sophie Bluel <span>Architecte d'inteérieur</span></h1>
		<nav>
			<ul>
				<li>projets</li>
				<li>contact</li>
				<li><a href="./login.html" id="connect">login</a></li>
				<li><img src="./assets/icons/instagram.png" alt="Instagram"></li>
			</ul>
		</nav>
	</header>
	<main>
		<section id="introduction">
			<figure>
				<img src="./assets/images/sophie-bluel.png" alt="Sophie Bluel">
			</figure>
			<article>
				<h2>Designer d'espace</h2>
				<p>Je raconte votre histoire, je valorise vos idées. Je vous accompagne de la conception à la livraison
					finale du chantier.</p>
				<p>Chaque projet sera étudié en commun, de façon à mettre en valeur les volumes, les matières et les
					couleurs dans le respect de l'esprit des lieux et le choix adapté des matériaux. Le suivi du
					chantier sera assuré dans le souci du détail, le respect du planning et du budget.</p>
				<p>En cas de besoin, une équipe pluridisciplinaire peut-être constituée : architecte DPLG,
					décorateur(trice)</p>
			</article>
		</section>
		<section id="portfolio">
			<div class="projet">
				<h2>Mes Projets</h2>
				<div class="edit"></div>
			</div>
			<div class="filter" id="filter">
				<span class="filter_item selected">Tous</span>
			</div>
			<div class="gallery" id="gallery"></div>
		</section>
		<section id="contact">
			<h2>Contact</h2>
			<p>Vous avez un projet ? Discutons-en !</p>
			<form action="#" method="post">
				<label for="name">Nom</label>
				<input type="text" name="name" id="name">
				<label for="email">Email</label>
				<input type="email" name="email" id="email">
				<label for="message">Message</label>
				<textarea name="message" id="message" cols="30" rows="10"></textarea>
				<input type="submit" value="Envoyer">
			</form>
		</section>
	</main>

	<aside id="modal" aria-hidden="false" role="dialog" style="display: none;">
		<div class="modal_wrapper" id="gallery_wrapper" style="display: none;">
			<div class="header">
				<div class="modal_navigation">
					<div class="close" id="modal_close">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
							<path
								d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z" />
						</svg>
					</div>
				</div>
				<h2>Galerie photo</h2>
			</div>

			<div class="content">
				<div class="modal_gallery" id="modal_gallery"></div>
				<div class="modal_footer">
					<div class="line"></div>
					<div class="btn_container">
						<a class="add_image" id="modal_next">Ajouter une photo</a>
						<a class="delete_all">Supprimer la galerie</a>
					</div>
				</div>
			</div>
		</div>
		<div class="modal_wrapper" id="add_image_wrapper" style="display: none;">
			<div class="header">
				<div class="modal_navigation">
					<div class="previous" id="modal_previous">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
							<path
								d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
						</svg>
					</div>
					<div class="close" id="modal_close">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
							<path
								d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z" />
						</svg>
					</div>
				</div>
				<h2>Ajout photo</h2>
			</div>
			<div class="content">
				<form class="form_container">
					<label for="img" class="image_preview">
						<div class="preview_container">
							<input type="file" name="img" id="img" class="input_preview_src">
							<svg width="58" height="58" viewBox="0 0 58 58" fill="none"
								xmlns="http://www.w3.org/2000/svg">
								<path
									d="M57 6H1C0.448 6 0 6.447 0 7V51C0 51.553 0.448 52 1 52H57C57.552 52 58 51.553 58 51V7C58 6.447 57.552 6 57 6ZM56 50H2V8H56V50Z"
									fill="#B9C5CC" />
								<path
									d="M16 28.138C19.071 28.138 21.569 25.64 21.569 22.57C21.569 19.498 19.071 17 16 17C12.929 17 10.431 19.498 10.431 22.569C10.431 25.64 12.929 28.138 16 28.138ZM16 19C17.968 19 19.569 20.602 19.569 22.569C19.569 24.536 17.968 26.138 16 26.138C14.032 26.138 12.431 24.537 12.431 22.57C12.431 20.603 14.032 19 16 19Z"
									fill="#B9C5CC" />
								<path
									d="M7.00004 46C7.23404 46 7.47004 45.918 7.66004 45.751L23.973 31.389L34.275 41.69C34.666 42.081 35.298 42.081 35.689 41.69C36.08 41.299 36.08 40.667 35.689 40.276L30.882 35.469L40.063 25.415L51.324 35.738C51.731 36.111 52.364 36.083 52.737 35.676C53.11 35.269 53.083 34.636 52.675 34.263L40.675 23.263C40.479 23.084 40.218 22.995 39.955 23.001C39.69 23.013 39.44 23.13 39.261 23.326L29.467 34.053L24.724 29.31C24.35 28.937 23.752 28.918 23.356 29.266L6.33904 44.249C5.92404 44.614 5.88404 45.246 6.24904 45.661C6.44704 45.886 6.72304 46 7.00004 46Z"
									fill="#B9C5CC" />
							</svg>
							<div class="add_btn">
								<label>+ Ajouter photo</label>
							</div>
							<label class="input_info">jpg, png : 4mo max</label>
						</div>
					</label>

					<div class="input_form">
						<label for="text">Titre</label>
						<input type="text" name="text" id="text">
						<label for="email">E-mail</label>
						<div class="select_categories">
							<select name="categories_list" id="categories_list">
								<option selected disabled></option>
							</select>
						</div>
					</div>

					<div class="line"></div>

					<input type="submit" value="Valider">
				</form>
			</div>
		</div>
	</aside>

	<footer>
		<nav>
			<ul>
				<li>Mentions Légales</li>
			</ul>
		</nav>
	</footer>
</body>

</html>


<script>
	const api_Url = 'http://localhost:5678/api/';
	const jwt = sessionStorage.getItem('Token');

	if (jwt != null) {
		const edit = document.querySelector('#portfolio .edit');
		edit.innerHTML =
			`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M373.1 24.97C401.2-3.147 446.8-3.147 474.9 24.97L487 37.09C515.1 65.21 515.1 110.8 487 138.9L289.8 336.2C281.1 344.8 270.4 351.1 258.6 354.5L158.6 383.1C150.2 385.5 141.2 383.1 135 376.1C128.9 370.8 126.5 361.8 128.9 353.4L157.5 253.4C160.9 241.6 167.2 230.9 175.8 222.2L373.1 24.97zM440.1 58.91C431.6 49.54 416.4 49.54 407 58.91L377.9 88L424 134.1L453.1 104.1C462.5 95.6 462.5 80.4 453.1 71.03L440.1 58.91zM203.7 266.6L186.9 325.1L245.4 308.3C249.4 307.2 252.9 305.1 255.8 302.2L390.1 168L344 121.9L209.8 256.2C206.9 259.1 204.8 262.6 203.7 266.6zM200 64C213.3 64 224 74.75 224 88C224 101.3 213.3 112 200 112H88C65.91 112 48 129.9 48 152V424C48 446.1 65.91 464 88 464H360C382.1 464 400 446.1 400 424V312C400 298.7 410.7 288 424 288C437.3 288 448 298.7 448 312V424C448 472.6 408.6 512 360 512H88C39.4 512 0 472.6 0 424V152C0 103.4 39.4 64 88 64H200z"/></svg>
			<span>modifier</span>`;

		edit.addEventListener('click', event => {
			modalGallery()

			document.getElementById('modal').style.display = null;
			document.querySelectorAll('#modal > *')[0].style.display = null;
			document.querySelectorAll('#modal > *')[1].style.display = 'none';
		})
	}

	async function apiRequest(param, type) {
		const response = await fetch(`${api_Url}${param}`, {
			method: `${type}`
		});

		if (response.status != 200) return;
		const result = await response.json();
		return result;
	}

	// Filter
	(async function main() {
		const setFilter = await apiRequest('categories', 'GET');

		filter(setFilter); // Add HTML Filter
		gallery(); // Add HTML Images
	})()

	async function filter(filter) {
		const htmlFilter = document.getElementById('filter');
		const selectHtmlFilter = document.getElementById('categories_list');
		filter.forEach(elem => {
			htmlFilter.innerHTML += `<span class="filter_item" id="${elem.id}">${elem.name}</span>`;
			selectHtmlFilter.innerHTML += `<option value='${elem.name}'>${elem.name}</option>`;
		});

		htmlFilter.childNodes.forEach(item => {
			item.addEventListener('click', value => {
				const currentItem = document.querySelector('#filter .selected').classList.remove('selected');
				value.target.classList.add('selected');

				gallery(value.target.id)
			})
		})
	}

	async function gallery(param) {
		const setImage = await apiRequest('works', 'GET');

		const gallery = document.getElementById('gallery');
		let htmlValue = '';

		setImage.forEach(function (elem) {
			if (param == '' || param === undefined || elem.categoryId == param) {
				htmlValue +=
					`<figure>
						<img src="${elem.imageUrl}" alt="${elem.title}" crossorigin="anonymous">
						<figcaption>${elem.title}</figcaption>
					</figure>`;
			};
		});
		gallery.innerHTML = htmlValue;
	}

	async function modalGallery() {
		const setImage = await apiRequest('works', 'GET');

		const gallery = document.getElementById('modal_gallery');
		let htmlValue = '';

		setImage.forEach(function (elem) {
			htmlValue +=
				`<figure id="figure-${elem.id}">
					<img src="${elem.imageUrl}" alt="${elem.title}" crossorigin="anonymous">
					<div class="delete_icon" id="delete_image" item-id="${elem.id}"><svg width="9" height="9" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.6 1.8V0.9C6.6 0.402944 6.19704 0 5.7 0H3.3C2.80294 0 2.4 0.402944 2.4 0.9V1.8H0V2.4H0.6V8.1C0.6 8.59704 1.00294 9 1.5 9H7.5C7.99704 9 8.4 8.59704 8.4 8.1V2.4H9V1.8H6.6ZM3 0.9C3 0.734316 3.13432 0.6 3.3 0.6H5.7C5.86568 0.6 6 0.734316 6 0.9V1.8H3V0.9ZM4.2 4.2V7.2H4.8V4.2H4.2ZM2.4 7.2V5.4H3V7.2H2.4ZM6 5.4V7.2H6.6V5.4H6Z"/></svg></div>
					<figcaption>éditer</figcaption>
				</figure>`;
		});
		gallery.innerHTML = htmlValue;

		const deleteBtn = document.querySelectorAll('#delete_image');

		deleteBtn.forEach(element => {
			element.addEventListener('click', async function (event) {
				event.preventDefault();

				const itemId = event.currentTarget.getAttribute('item-id');
				document.getElementById(`figure-${itemId}`).remove();
				deleteRequest(itemId);
			});
		});
	};

	async function deleteRequest(param) {
		const response = await fetch(`${api_Url}works/${param}`, {
			method: 'DELETE',
			headers: {
				'Content-Type': 'application/json',
				'Authorization': `${jwt}`
			},
		}).then((response) => {
			console.log(response);
		})
	};

	// Modal
	const modal = document.getElementById('modal');
	const pages = document.getElementsByClassName('modal_wrapper');
	const next = document.getElementById('modal_next');
	const previous = document.getElementById('modal_previous');
	const closeModal = document.querySelectorAll('#modal_close');

	next.addEventListener('click', event => {
		event.preventDefault();
		pages[0].style.display = 'none'
		pages[1].style.display = null;
	})

	previous.addEventListener('click', event => {
		event.preventDefault();
		pages[1].style.display = 'none';
		pages[0].style.display = null;
	})

	closeModal.forEach(elem => {
		elem.addEventListener('click', event => {
			event.preventDefault();

			modal.style.display = 'none';
			pages[0].style.display = 'none'
			pages[1].style.display = 'none';
		})
	})

	window.onclick = function (event) {
		if (event.target == modal) {
			modal.style.display = "none";
		}
	}

	//Image preview
	const fileImage = document.querySelector('.input_preview_src');
	const filePreview = document.querySelector('.preview_container');

	fileImage.onchange = function () {
		const reader = new FileReader();

		reader.onload = function (event) {
			filePreview.style.backgroundImage = `url('${event.target.result}')`;
		};

		document.querySelectorAll('.preview_container > *').forEach(elem => {
			elem.style.display = 'none';
		})
		reader.readAsDataURL(this.files[0]);
	};
</script>